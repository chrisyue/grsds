<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description"  content="包含预扣预缴和汇算清缴，收入种类包括工资和劳务报酬，劳务报酬包含增值税的计算" />
        <title>个人所得税计算器</title>
        <link href="https://cdn.bootcss.com/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
        <style>
            h1 {
                text-shadow: 1px 1px 1px #999;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1 class="mt-5 mb-5 display-4 text-center">个人所得税计算器</h1>
            <hr>
            <h2>预缴预扣</h2>
            <p class="text-secondary">预缴预扣为个人每次获取收入时税务局预先收取的个税，由代发工资部门（一般为公司）代缴。</p>
            <hr>
            <h3>工资</h3>
            <table class="table table-striped table-responsive text-nowrap gzTable">
                <thead>
                    <tr>
                        <th></th>
                        <th>税前工资</th>
                        <th>起征点</th>
                        <th>专项扣除</th>
                        <th>专项附加扣除</th>
                        <th>预扣税</th>
                        <th>税后工资</th>
                        <th>到手工资</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="btn-group btn-group-sm text-nowrap">
                                <button class="btn btn-primary copy">复制到下个月</button>
                                <button class="btn btn-danger remove">删除</button>
                            </div>
                        </td>
                        <td><input type="text" class="form-control form-control-sm salary" value="10000"></td>
                        <td class="cutoff1">5000</td>
                        <td><input type="text" class="form-control form-control-sm cutoff2" value="2223"></td>
                        <td><input type="text" class="form-control form-control-sm cutoff3" value="2000"></td>
                        <td class="tax">23.31</td>
                        <td class="left">9976.69</td>
                        <td class="income">7753.69</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th>总计</th>
                        <td class="grsd">10000.00</td>
                        <td>5000.00</td>
                        <td class="zxkc">2223.00</td>
                        <td>2000.00</td>
                        <td>23.31</td>
                        <td>9976.69</td>
                        <td>7753.69</td>
                    </tr>
                </tfoot>
            </table>
            <p>
                <button class="btn btn-primary more-salary-records">添加更多公司的工资记录</button>
            </p>

            <h3>劳务</h3>
            <table class="table table-striped table-responsive text-nowrap" id="lwTable">
                <thead>
                    <tr>
                        <th></th>
                        <th>税前报酬</th>
                        <th>含增值税</th>
                        <th>增值税</th>
                        <th>附加税比例</th>
                        <th>附加税</th>
                        <th>个人收入</th>
                        <th>收入预扣</th>
                        <th>最终所得</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="btn-group btn-group-sm text-nowrap">
                                <button class="btn btn-primary copy">复制</button>
                                <button class="btn btn-danger remove">删除</button>
                            </div>
                        </td>
                        <td><input type="text" class="form-control form-control-sm pay" value="10000"></td>
                        <td class="text-center"><input type="checkbox" class="form-control-input including-vat" checked></td>
                        <td class="vat">291.26</td>
                        <td><input type="text" value="0.07" class="form-control form-control-sm extra-ratio ratio"></td>
                        <td class="extra">20.39</td>
                        <td class="income">9688.35</td>
                        <td class="tax">1550.14</td>
                        <td class="left">8138.21</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th>总计</th>
                        <td>10000</td>
                        <td></td>
                        <td>291.26</td>
                        <td></td>
                        <td>20.39</td>
                        <td class="grsd">9688.35</td>
                        <td>1550.14</td>
                        <td>8138.21</td>
                    </tr>
                </tfoot>
            </table>

            <h2>汇算清缴</h2>
            <p class="text-secondary">汇算清缴是以自然年为单位，按个人一年所有收入来重新计算个税。因为和预缴预扣算法有所不同，可能会出现差别。如果有差别可以在次年通过『个人所得税』App 进行多退少补的操作。</p>
            <hr>
            <p>
                <button class="btn btn-primary qj">按预缴信息直接汇算清缴</button>
            </p>
            <p>
                或者通过以下表单汇算清缴
            </p>
            <form class="form-inline">
                <input type="text" class="form-control mr-sm-2 mb-2" id="qngzsr" placeholder="全年工资收入">
                <input type="text" class="form-control mr-sm-2 mb-2" id="qnlwsr" placeholder="全年劳务收入">
                <input type="text" class="form-control mr-sm-2 mb-2" id="qnzxkc" placeholder="全年专项扣除" required>
                <input type="text" class="form-control mr-sm-2 mb-2" id="qnfjkc" placeholder="全年专项附加扣除" required>
                <button class="btn btn-primary mr-sm-2 mb-2" type="submit">提交</button>
            </form>

            <div class="modal fade" id="qjModal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">汇算清缴结果</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <table class="table table-striped">
                                <tr>
                                    <th>年度综合所得</th>
                                    <td id="zhsd">17750.68</td>
                                </tr>
                                <tr>
                                    <th>全年专项扣除</th>
                                    <td id="zxkc">2223</td>
                                </tr>
                                <tr>
                                    <th>全年专项附加扣除</th>
                                    <td id="fjkc">2000</td>
                                </tr>
                                <tr>
                                    <th>全年个人所得税</th>
                                    <td id="grsds">0</td>
                                </tr>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <p>
                <a href="" class="btn btn-info">刷新页面重置表单<a>
                <a href="https://www.chrisyue.com/?p=4309" class="btn btn-success">提点意见</a>
            </p>
            <p class="text-center mt-5 mb-5">
                <img src="http://img.chrisyue.com/wx-reward-code.jpg" alt="微信打赏码" title="微信打赏码" width="220" height="220">
            </p>
        </div>
        <footer class="mt-5">
            <p class="text-center">
                <a href="https://github.com/chrisyue/grsds">在 GitHub 关注此项目</a>
                |
                <a href="https://www.chrisyue.com">chrisyue.com</a>
            </p>
        </footer>
        <script src="https://cdn.bootcss.com/jquery/3.5.0/jquery.min.js"></script>
        <script src="https://cdn.bootcss.com/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
        <script>
            // 工资公式
            function gzTax(amount) {
                if (amount <= 0) {
                    return 0;
                }
                if (amount <= 36000) {
                    return amount * .03;
                }
                if (amount <= 144000) {
                    return amount * .1 - 2520;
                }
                if (amount <= 300000) {
                    return amount * .2 - 16920;
                }
                if (amount <= 420000) {
                    return amount * .25 - 31920;
                }
                if (amount <= 660000) {
                    return amount * .3 - 52920;
                }
                if (amount <= 960000) {
                    return amount * .35 - 85920;
                }

                return amount * .45 - 181920;
            }

            // 劳务预扣公式
            function lwTax(amount) {
                if (amount <= 800) {
                    return 0;
                }

                let base = amount - 800;
                if (amount > 4000) {
                    base = amount * .8;
                }

                if (base  <= 20000) {
                    return base * .2;
                }

                if (base <= 50000) {
                    return base * .3 - 2000;
                }

                return base * .4 - 7000;
            }

            function addNewGzTable() {
                let $lastTable = $('.gzTable').last();
                let $newTable = $lastTable.clone(true)
                $newTable.find('tr:not(:first-child)').remove();
                refreshGzTable($newTable);
                $newTable.insertAfter($lastTable);
            }

            $.fn.extend({
                sum: function () {
                    let $table = $(this);
                    let columns = [];
                    let $footTds = $table.find('tfoot td');
                    let columnCnt = $footTds.length;
                    $table.find('tbody tr').each((index, tr) => {
                        for (let i = 0; i < columnCnt; ++i) {
                            let $td = $(tr).find('td').eq(i + 1);
                            let num = +$td.html() || +$td.find('input:not(.ratio)').val();

                            if (isNaN(num)) {
                                continue;
                            }

                            if (!columns[i]) {
                                columns[i] = 0;
                            }

                            columns[i] += num;
                        }
                    });

                    for (let i = 0; i < columnCnt; ++i) {
                        let num = columns[i];
                        if (isNaN(num)) {
                            $footTds.eq(i).empty();

                            continue;
                        }

                        $footTds.eq(i).html(num.toFixed(2));
                    }
                }
            });

            // 刷新工资表
            function refreshGzTable($gzTable) {
                let totalSalary = 0;
                let totalCutoff = 0;
                let totalTax = 0;
                $gzTable.find('tbody tr').each((i, tr) => {
                    let $tr = $(tr);
                    let salary = +$tr.find('.salary').val();
                    totalSalary += salary;
                    let cutoff1 = +$tr.find('.cutoff1').html();
                    let cutoff2 = +$tr.find('.cutoff2').val();
                    let cutoff3 = +$tr.find('.cutoff3').val();
                    let cutoff = cutoff1 + cutoff2 + cutoff3;
                    totalCutoff += cutoff;

                    let tax = gzTax(totalSalary - totalCutoff).toFixed(2);
                    let monthTax = Math.max((tax - totalTax), 0);
                    totalTax = Math.max(tax, totalTax);

                    let left = salary - monthTax;
                    let income = left - cutoff2;

                    $tr.find('.tax').html(monthTax.toFixed(2));
                    $tr.find('.left').html(left.toFixed(2));
                    $tr.find('.income').html(income.toFixed(2));
                });

                $gzTable.sum();
            }

            $(() => {
                // 工资记录复制
                let $gzTable = $('.gzTable');
                $('.gzTable').find('.copy').on('click', (e) => {
                    let $gzTable = $(e.target).parents('.gzTable');
                    if (12 === $gzTable.find('tbody tr').length) {
                        let message = '12 个月的记录已满，您是否还需要添加别的公司的工资收入记录？';
                        if (confirm(message)) {
                            addNewGzTable();
                        }

                        return;
                    }

                    let $tr = $(e.target).parents('tr');

                    let $tr2 = $tr.clone(true);
                    $tr.parent().append($tr2);

                    refreshGzTable($gzTable);
                });
                // 删除记录
                $gzTable.find('.remove').on('click', (e) => {
                    $(e.target).parents('tr').remove();

                    refreshGzTable($(e.target).parents('.gzTable'));
                });

                // 工资预扣
                $gzTable.on('change', 'input', (e) => {
                    refreshGzTable($(e.target).parents('.gzTable'));
                });

                let $lwTable = $('#lwTable');
                // 劳务记录复制
                $lwTable.find('.copy').on('click', (e) => {
                    let $tr = $(e.target).parents('tr');

                    $tr.clone(true).appendTo($tr.parent());
                    $lwTable.sum();
                });
                // 删除记录
                $lwTable.find('.remove').on('click', (e) => {
                    $(e.target).parents('tr').remove();

                    $lwTable.sum();
                });

                // 劳务 vat, vat 附加税，个人预扣
                $lwTable.on('change', 'input', (e) => {
                    let $tr = $(e.target).parents('tr');
                    let includingVat = $tr.find('.including-vat').is(':checked');

                    let $vat = $tr.find('.vat');
                    let $extraRatio = $tr.find('.extra-ratio');
                    let $extra = $tr.find('.extra');
                    let $income = $tr.find('.income');
                    let $tax = $tr.find('.tax');
                    let $left = $tr.find('.left');

                    let pay = $tr.find('.pay').val();

                    $extraRatio.prop('disabled', !includingVat);
                    if (includingVat) {
                        let vat = pay / 1.03 * 0.03;
                        let extra = vat * $tr.find('.extra-ratio').val();
                        $vat.html(vat.toFixed(2));
                        $extra.html(extra.toFixed(2));
                        let income = pay - vat - extra;
                        $income.html(income.toFixed(2));
                        let tax = lwTax(income);
                        $tax.html(tax.toFixed(2));
                        let left = income - tax;
                        $left.html(left.toFixed(2));

                        $lwTable.sum();

                        return;
                    }

                    $vat.html('N/A');
                    $extra.html('N/A');
                    let tax = lwTax(pay);
                    $tax.html(tax.toFixed(2));
                    $left.html((pay - tax).toFixed(2));
                    $income.html(pay);

                    $lwTable.sum();
                });

                $('.qj').on('click', (e) => {
                    let zhsd = 0;
                    $('.gzTable .grsd').each((i, td) => {
                        zhsd += +$(td).html();
                    });
                    let lwsd = +$('#lwTable .grsd').html();
                    if (lwsd) {
                        zhsd += lwsd * .8;
                    }
                    let zxkc = 0;
                    $('table .zxkc').each((i, td) => {
                        zxkc += +$(td).html();
                    });
                    let fjkc = (+$('.cutoff3').first().val()) * 12;

                    $('#zhsd').html(zhsd.toFixed(2));
                    $('#zxkc').html(zxkc.toFixed(2));
                    $('#fjkc').html(fjkc.toFixed(2));

                    let grsds = gzTax(zhsd - zxkc - fjkc - 60000);
                    $('#grsds').html(grsds.toFixed(2));

                    $('#qjModal').modal();
                });

                $('form').on('submit', (e) => {
                    e.preventDefault();

                    let grsr = +$('#qngzsr').val();
                    let lwsr = +$('#qnlwsr').val();
                    let zxkc = +$('#qnzxkc').val();
                    let fjkc = +$('#qnfjkc').val();

                    let zhsd = grsr + lwsr * .8;

                    $('#zhsd').html(zhsd.toFixed(2));
                    $('#zxkc').html(zxkc.toFixed(2));
                    $('#fjkc').html(fjkc.toFixed(2));

                    let grsds = gzTax(zhsd - zxkc - fjkc - 60000);
                    $('#grsds').html(grsds.toFixed(2));

                    $('#qjModal').modal();
                });

                $('.more-salary-records').on('click', (e) => {
                    addNewGzTable();
                });
            });
        </script>
        <script>
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?a81431453cb4c105abb92bdfddd13a6d";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    </body>
</html>
